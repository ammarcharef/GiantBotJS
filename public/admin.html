<!DOCTYPE html>
<html dir="rtl">
<body style="background:#000; color:#0f0; font-family:monospace; padding:20px;">
    <h1>SYSTEM ADMIN</h1>
    <input id="pass" type="password" placeholder="Password">
    <button onclick="login()">LOGIN</button>
    
    <div id="panel" style="display:none; margin-top:20px;">
        <div style="border:1px solid #333; padding:10px; margin-bottom:20px;">
            <h3>ADD SHOP ITEM</h3>
            <input id="s-name" placeholder="Name">
            <input id="s-desc" placeholder="Description">
            <input id="s-price" type="number" placeholder="Price">
            <button onclick="addItem()">ADD ITEM</button>
        </div>

        <div style="border:1px solid #333; padding:10px;">
            <h3>ADD TASK</h3>
            <input id="t-title" placeholder="Title">
            <input id="t-url" placeholder="URL">
            <input id="t-reward" type="number" placeholder="Reward (DZD)">
            <input id="t-xp" type="number" placeholder="XP">
            <input id="t-sec" type="number" placeholder="Seconds">
            <button onclick="addTask()">ADD TASK</button>
        </div>
        
        <h3>PENDING ORDERS</h3>
        <div id="orders"></div>
    </div>

    <script>
        let pass = "";
        async function login() {
            pass = document.getElementById('pass').value;
            const res = await fetch('/api/admin', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({pass, action:'stats'}) });
            const json = await res.json();
            if(json.error) return alert("Wrong");
            document.getElementById('panel').style.display = 'block';
            renderOrders(json.orders);
        }
        
        function renderOrders(list) {
            document.getElementById('orders').innerHTML = list.map(o => `<div>${o.item} - ${o.price} DZD <button onclick="pay('${o._id}')">DONE</button></div>`).join('');
        }

        async function addItem() {
            const payload = {
                name: document.getElementById('s-name').value,
                description: document.getElementById('s-desc').value,
                price: document.getElementById('s-price').value
            };
            await fetch('/api/admin', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({pass, action:'add_item', payload}) });
            alert("Added");
        }

        async function addTask() {
            const payload = {
                title: document.getElementById('t-title').value,
                url: document.getElementById('t-url').value,
                reward: document.getElementById('t-reward').value,
                xpReward: document.getElementById('t-xp').value,
                seconds: document.getElementById('t-sec').value
            };
            await fetch('/api/admin', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({pass, action:'add_task', payload}) });
            alert("Added");
        }
        
        async function pay(id) {
            await fetch('/api/admin', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({pass, action:'pay_order', payload:{id}}) });
            alert("Paid");
        }
    </script>
</body>
</html>