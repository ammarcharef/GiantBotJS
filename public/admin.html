<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Admin</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div style="max-width:600px; margin:auto">
        <div class="glass">
            <h2>لوحة الإدارة</h2>
            <input type="password" id="pass" placeholder="كلمة المرور">
            <button class="btn" onclick="loadStats()">دخول</button>
        </div>

        <div id="admin-panel" class="hidden">
            <div class="glass">
                <h3>إضافة إعلان</h3>
                <input id="t-title" placeholder="العنوان">
                <input id="t-url" placeholder="الرابط">
                <input id="t-price" type="number" placeholder="السعر الكامل">
                <input id="t-sec" type="number" placeholder="الوقت (ثواني)">
                <button class="btn" onclick="addTask()">نشر</button>
            </div>
            
            <div id="users-list"></div>
        </div>
    </div>

    <script>
        async function loadStats() {
            const password = document.getElementById('pass').value;
            const res = await fetch('/api/admin', {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ password, action: 'stats' })
            });
            const data = await res.json();
            if (data.error) return alert("خطأ في كلمة المرور");

            document.getElementById('admin-panel').classList.remove('hidden');
            
            const list = document.getElementById('users-list');
            list.innerHTML = "<h3>أحدث المستخدمين</h3>" + data.users.map(u => `
                <div class="glass task">
                    <div>${u.name} <br> <small>${u.paymentAccount || 'غير مسجل'}</small></div>
                    <div class="gold">${u.balance.toFixed(2)}</div>
                </div>
            `).join('');
        }

        async function addTask() {
            const password = document.getElementById('pass').value;
            const payload = {
                title: document.getElementById('t-title').value,
                url: document.getElementById('t-url').value,
                fullPrice: document.getElementById('t-price').value,
                seconds: document.getElementById('t-sec').value
            };
            await fetch('/api/admin', {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ password, action: 'add_task', payload })
            });
            alert("تم النشر");
        }
    </script>
</body>
</html>
