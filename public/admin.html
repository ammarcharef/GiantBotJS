<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Master Admin</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body { overflow: auto; background: #000; padding: 20px; }
        .glass { background: #111; border: 1px solid #333; }
        input, button { border-radius: 5px; }
        .chart-container { height: 300px; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div style="max-width:900px; margin:auto;">
        <div class="glass" style="display:flex; justify-content:space-between; align-items:center;">
            <h2>ğŸ‘‘ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±</h2>
            <div>
                <input type="password" id="pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±" style="width:150px;">
                <button class="btn-act" onclick="auth()">Ø¯Ø®ÙˆÙ„</button>
            </div>
        </div>

        <div id="panel" class="hidden">
            <div class="grid-menu">
                <div>ğŸ‘¥ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† <br><span id="s-usr" class="gold">0</span></div>
                <div>ğŸ’° Ø³Ø­ÙˆØ¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø© <br><span id="s-wth" class="red">0</span></div>
            </div>

            <div class="glass">
                <h3>â• Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                    <input id="t-title" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†">
                    <input id="t-url" placeholder="Ø§Ù„Ø±Ø§Ø¨Ø·">
                    <input id="t-price" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙƒØ§Ù…Ù„">
                    <input id="t-sec" type="number" placeholder="Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ">
                </div>
                <button class="btn primary" onclick="addTask()">Ù†Ø´Ø± Ø§Ù„Ù…Ù‡Ù…Ø© ğŸš€</button>
            </div>

            <div class="glass">
                <h3>ğŸŸï¸ Ø¥ØµØ¯Ø§Ø± ÙƒÙˆØ¨ÙˆÙ†</h3>
                <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px;">
                    <input id="c-code" placeholder="Ø§Ù„ÙƒÙˆØ¯">
                    <input id="c-amnt" type="number" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº">
                    <input id="c-max" type="number" placeholder="Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰">
                </div>
                <button class="btn primary" onclick="addCoupon()">Ø¥Ù†Ø´Ø§Ø¡</button>
            </div>

            <h3>Ø·Ù„Ø¨Ù€Ø§Øª Ø§Ù„Ø³Ø­Ø¨</h3>
            <div id="w-list"></div>
        </div>
    </div>

    <script>
        let pass = "";
        async function auth() {
            pass = document.getElementById('pass').value;
            loadData();
        }
        async function loadData() {
            const res = await fetch('/api/admin', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({password:pass, action:'data'}) });
            const data = await res.json();
            if(data.error) return alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø®Ø§Ø·Ø¦Ø©");
            
            document.getElementById('panel').classList.remove('hidden');
            document.getElementById('s-usr').innerText = data.stats.users;
            document.getElementById('s-wth').innerText = data.stats.withdraws;
            
            document.getElementById('w-list').innerHTML = data.withdrawals.map(w => `
                <div class="glass" style="display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <div style="font-weight:bold; font-size:1.1rem">${w.amount} DZD</div>
                        <div style="color:#aaa">${w.userName} | ${w.method}</div>
                        <div style="color:#fbbf24">${w.account}</div>
                    </div>
                    <div>
                        <button class="btn-act" onclick="proc('${w._id}', 'paid')">ØªÙ… Ø§Ù„Ø¯ÙØ¹</button>
                        <button class="btn danger" style="padding:5px 15px; margin-top:0;" onclick="proc('${w._id}', 'rejected')">Ø±ÙØ¶</button>
                    </div>
                </div>
            `).join('');
        }

        async function addTask() {
            const payload = {
                title: document.getElementById('t-title').value,
                url: document.getElementById('t-url').value,
                fullPrice: document.getElementById('t-price').value,
                seconds: document.getElementById('t-sec').value
            };
            await fetch('/api/admin', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({password:pass, action:'add_task', payload}) });
            alert("ØªÙ… Ø§Ù„Ù†Ø´Ø±");
        }

        async function addCoupon() {
            const payload = {
                code: document.getElementById('c-code').value,
                amount: document.getElementById('c-amnt').value,
                maxUses: document.getElementById('c-max').value
            };
            await fetch('/api/admin', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({password:pass, action:'add_coupon', payload}) });
            alert("ØªÙ… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡");
        }

        async function proc(id, status) {
            if(!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ")) return;
            await fetch('/api/admin', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({password:pass, action:'process_withdraw', payload:{id, status}}) });
            loadData();
        }
    </script>
</body>
</html>
